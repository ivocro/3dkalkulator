<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>aparati</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* ... (isti stilovi kao prije) ... */
  </style>
</head>
<body>
  <div class="container">
    <h1>Upravljanje aparatima</h1>

    <p>
      <a href="index.html" class="back-link">&larr; Natrag na kalkulator</a>
    </p>

    <form id="machine-form">
      <input type="hidden" id="editIndex" value="-1" />

      <div class="form-group">
        <label for="machineName">Naziv aparata:</label>
        <input type="text" id="machineName" required />
      </div>
      <div class="form-group">
        <label for="purchasePrice">Nabavna vrijednost (EUR):</label>
        <input type="number" id="purchasePrice" min="0" step="0.01" required />
      </div>
      <div class="form-group">
        <label for="purchaseDate">Datum kupnje:</label>
        <input type="date" id="purchaseDate" required />
      </div>
      <div class="form-group">
        <label for="lifetimeHours">Očekivani radni vijek (u satima):</label>
        <input type="number" id="lifetimeHours" min="1" step="1" required />
      </div>
      <div class="form-group">
        <label for="maintenanceCost">Ukupni trošak održavanja kroz vijek (EUR):</label>
        <input type="number" id="maintenanceCost" min="0" step="0.01" required />
      </div>
      <div class="form-group">
        <label for="powerRating">Snaga aparata (u kW):</label>
        <input type="number" id="powerRating" min="0" step="0.01" required />
      </div>
      <div class="form-group">
        <label for="energyCost">Cijena energije (EUR/kWh):</label>
        <input type="number" id="energyCost" min="0" step="0.01" required />
      </div>
      <button type="submit" id="saveMachineBtn">Dodaj aparat</button>
    </form>

    <table id="machineTable" hidden>
      <thead>
        <tr>
          <th>Naziv aparata</th>
          <th>Nabavna vrijednost (EUR)</th>
          <th>Datum kupnje</th>
          <th>Radni vijek (h)</th>
          <th>Trošak održavanja (EUR)</th>
          <th>Snaga (kW)</th>
          <th>Cijena energ. (€/kWh)</th>
          <th>Akcije</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const form           = document.getElementById('machine-form');
    const editIndexInput = document.getElementById('editIndex');
    const saveBtn        = document.getElementById('saveMachineBtn');

    const nameInput         = document.getElementById('machineName');
    const priceInput        = document.getElementById('purchasePrice');
    const dateInput         = document.getElementById('purchaseDate');
    const lifetimeInput     = document.getElementById('lifetimeHours');
    const maintenanceInput  = document.getElementById('maintenanceCost');
    const powerInput        = document.getElementById('powerRating');
    const energyInput       = document.getElementById('energyCost');

    const table      = document.getElementById('machineTable');
    const tbody      = table.querySelector('tbody');

    let machines = []; 

    // 1) PRI UČITAVANJU STRANICE: fetchaj machines.json
    async function loadFromJson() {
      try {
        const resp = await fetch('machines.json');
        if (!resp.ok) throw new Error('Ne mogu učitati machines.json');
        machines = await resp.json();
      } catch (err) {
        console.warn('Greška pri učitavanju machines.json, koristim prazan niz:', err);
        machines = [];
      }
      renderTable();
    }

    // 2) renderTable() iscrtava tablicu iz niza 'machines'
    function renderTable() {
      tbody.innerHTML = '';
      machines.forEach((m, index) => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${m.name}</td>
          <td>${m.price.toFixed(2)}</td>
          <td>${m.date}</td>
          <td>${m.lifetime}</td>
          <td>${m.maintenance.toFixed(2)}</td>
          <td>${m.power.toFixed(2)}</td>
          <td>${m.energyCost.toFixed(2)}</td>
          <td>
            <button class="edit-btn" data-index="${index}">Uredi</button>
            <button class="delete-btn" data-index="${index}">Obriši</button>
          </td>
        `;
      });
      table.hidden = machines.length === 0;
      attachActionListeners();
    }

    // 3) veži Edit/Delete event listenere
    function attachActionListeners() {
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const idx = +e.target.dataset.index;
          enterEditMode(idx);
        });
      });
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const idx = +e.target.dataset.index;
          machines.splice(idx, 1);
          renderTable();
          // NAKON BRIŠENJA: morat ćeš ručno commitati machines.json
        });
      });
    }

    function enterEditMode(idx) {
      const m = machines[idx];
      nameInput.value        = m.name;
      priceInput.value       = m.price;
      dateInput.value        = m.date;
      lifetimeInput.value    = m.lifetime;
      maintenanceInput.value = m.maintenance;
      powerInput.value       = m.power;
      energyInput.value      = m.energyCost;

      editIndexInput.value = idx;
      saveBtn.textContent  = 'Spremi promjene';
    }

    function exitEditMode() {
      form.reset();
      editIndexInput.value = -1;
      saveBtn.textContent  = 'Dodaj aparat';
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const name        = nameInput.value.trim();
      const price       = parseFloat(priceInput.value) || 0;
      const date        = dateInput.value;
      const lifetime    = parseInt(lifetimeInput.value) || 0;
      const maintenance = parseFloat(maintenanceInput.value) || 0;
      const power       = parseFloat(powerInput.value) || 0;
      const energyCost  = parseFloat(energyInput.value) || 0;

      const idx = +editIndexInput.value;
      if (idx >= 0) {
        machines[idx] = { name, price, date, lifetime, maintenance, power, energyCost };
      } else {
        machines.push({ name, price, date, lifetime, maintenance, power, energyCost });
      }
      exitEditMode();
      renderTable();
      // NAKON BILO KAKVE IZMJENE: machines.json MORAJU BI TEBE RUČNO AŽURIRATI (vidi dolje)
    });

    document.addEventListener('DOMContentLoaded', loadFromJson);
  </script>
</body>
</html>
